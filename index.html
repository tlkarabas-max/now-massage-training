<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NOW Schedule Optimization Training (Upgraded)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: linear-gradient(120deg, #6f7bf7 0%, #a7bfff 100%);
            margin: 0;
        }
        .container {
            max-width: 1100px;
            margin: 36px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 2px 18px rgba(35,49,123,0.08);
            padding: 40px 48px 50px 48px;
        }
        .header {
            font-size: 2.2rem;
            font-weight: 700;
            color: #4a54c4;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        .subhead {
            font-size: 1.1rem;
            color: #444;
            margin-bottom: 28px;
        }
        .nav-bar {
            display: flex;
            gap: 48px;
            justify-content: flex-start;
            align-items: center;
            border-bottom: 2px solid #ecedfa;
            margin-bottom: 28px;
            padding-bottom: 4px;
        }
        .nav-tab {
            font-size: 1.18em;
            font-weight: 500;
            background: none;
            border: none;
            color: #555;
            cursor: pointer;
            padding: 18px 0 12px 0;
            position: relative;
            transition: color 0.2s;
        }
        .nav-tab.active, .nav-tab:focus {
            color: #5a6cf7;
            font-weight: 700;
        }
        .nav-tab.active:after {
            content: "";
            position: absolute;
            left: 0; right: 0; bottom: -6px;
            height: 4px;
            background: #5973e7;
            border-radius: 6px;
        }
        .content {
            display: none;
            margin-top: 16px;
        }
        .content.active {
            display: block;
        }
        @media (max-width: 900px) {
            .container {
                padding: 20px 5vw;
            }
            .nav-bar {gap:24px;}
        }
        @media (max-width: 700px) {
            .container {padding: 12px 2vw;}
            .nav-bar {gap: 10px;flex-wrap: wrap;}
            .nav-tab {padding: 12px 0 8px 0;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">Schedule Optimization Training (Upgraded)</div>
        <div class="subhead">Master the art of maximizing revenue through smart scheduling</div>
        <div class="nav-bar">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('simulator')">Schedule Simulator</button>
            <button class="nav-tab" onclick="showTab('calculator')">Revenue Calculator</button>
            <button class="nav-tab" onclick="showTab('scenarios')">Practice Scenarios</button>
            <button class="nav-tab" onclick="showTab('quiz')">Knowledge Quiz</button>
            <button class="nav-tab" onclick="showTab('templates')">Script Templates</button>
            <button class="nav-tab" onclick="showTab('progress')">Progress Tracker</button>
        </div>
        <div id="overview" class="content active">
            <h2>Overview</h2>
            <p>Welcome! Use the tabs above to access all modules for schedule optimization and training.</p>
        </div>
        <div id="simulator" class="content">
            <h2>Schedule Simulator</h2>
            <p>[Your interactive simulator goes here]</p>
        </div>
        <div id="calculator" class="content">
            <h2>Revenue Calculator</h2>
            <p>[Your revenue calculator goes here]</p>
        </div>
        <div id="scenarios" class="content">
            <h2>Practice Scenarios</h2>
            <p>[Your scenarios and solution guidance go here]</p>
        </div>
        <div id="quiz" class="content">
            <h2>Knowledge Quiz</h2>
            <p>[Your knowledge quiz goes here]</p>
        </div>
        <div id="templates" class="content">
            <h2>Script Templates</h2>
            <p>[Your script templates go here]</p>
        </div>
        <div id="progress" class="content">
            <h2>Progress Tracker</h2>
            <p>[Your progress tracking dashboard goes here]</p>
        </div>
    </div>
<script>
function showTab(tab){
    document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
    document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
    document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
}
</script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOW Massage - Schedule Optimization Training (Upgraded)</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f7fafc;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.05);
            padding: 30px 40px 40px 40px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ececec;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 28px;
            cursor: pointer;
            background: #f1f3f4;
            border: none;
            outline: none;
            font-size: 1.1em;
            color: #444;
            transition: background 0.2s;
            margin-right: 2px;
        }
        .tab.active {
            background: #3866e6;
            color: #fff;
            font-weight: bold;
            border-bottom: 2px solid #3866e6;
        }
        .content {
            display: none;
            margin-top: 15px;
        }
        .content.active {
            display: block;
        }
        .score-panel {
            display: flex;
            gap: 30px;
            margin: 18px 0 12px 0;
            flex-wrap: wrap;
        }
        .stat-card {
            background: #eef2fb;
            border-radius: 8px;
            box-shadow: 0 1px 4px #e0e0e0;
            padding: 18px 26px;
            min-width: 120px;
            text-align: center;
            font-size: 1em;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3866e6;
        }
        .stat-label {
            font-size: 1em;
            color: #6d7ba1;
        }
        .controls {
            margin-top: 18px;
            display: flex;
            gap: 12px;
        }
        .btn {
            padding: 8px 22px;
            font-size: 1em;
            border-radius: 6px;
            border: 1px solid #bfcbe6;
            background: #f7fafd;
            color: #3866e6;
            cursor: pointer;
            margin-right: 8px;
            transition: background 0.2s;
        }
        .btn-primary {
            background: #3866e6;
            color: #fff;
            border: none;
        }
        .btn-secondary {
            background: #f7fafd;
            color: #3866e6;
            border: 1px solid #3866e6;
        }
        .btn:disabled, .btn[disabled] {
            background: #e0e0e0;
            color: #aaa;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            gap: 2px;
            margin-top: 12px;
            background: #e7ecf5;
            border-radius: 8px;
            overflow-x: auto;
        }
        .time-slot {
            background: #fff;
            border-radius: 4px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
            border: 1px solid #d2d8ee;
            transition: box-shadow 0.2s;
        }
        .time-slot.header {
            background: #3866e6;
            color: #fff;
            font-weight: bold;
            border-radius: 4px 4px 0 0;
            min-height: 32px;
        }
        .time-slot.time-header {
            background: #f3f6fc;
            color: #6d7ba1;
            font-weight: bold;
        }
        .booked-80 {
            background: #3866e6;
            color: #fff;
            font-weight: bold;
        }
        .booked-50 {
            background: #5ab2ff;
            color: #fff;
        }
        .gap {
            background: #f7ca4d;
            color: #333;
            font-weight: bold;
        }
        .open {
            background: #e4f8e7;
            color: #22613c;
        }
        .break {
            background: #f3e0fa;
            color: #7c3aed;
        }
        .lunch {
            background: #e3e9ff;
            color: #2c3e86;
        }
        .callout {
            background: #ff5757;
            color: #fff;
            font-weight: bold;
        }
        .solution-highlight {
            box-shadow: 0 0 0 3px #3866e6 inset, 0 0 12px #3866e6;
            border-radius: 8px;
            font-weight: bold;
            z-index: 2;
        }
        .hint-box {
            background: #e3e3fa;
            border-radius: 8px;
            padding: 10px 18px;
            margin: 18px 0 12px 0;
            color: #3866e6;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">Overview</div>
            <div class="tab" onclick="showTab('scenarios')">Practice Scenarios</div>
            <div class="tab" onclick="showTab('simulator')">Schedule Simulator</div>
        </div>
        <!-- Overview Tab -->
        <div id="overview" class="content active">
            <h2>Schedule Optimization Training</h2>
            <p>Practice filling gaps, staggering breaks/lunches, and maximizing therapist coverage using real-life scenarios from NOW Massage. Try the simulator, then check your solution!</p>
        </div>
        <!-- Practice Scenarios Tab -->
        <div id="scenarios" class="content">
            <h2>Practice Scenarios</h2>
            <div>
                <label for="scenarioDay"><strong>Select Day:</strong></label>
                <select id="scenarioDay"></select>
                <label for="scenarioNum"><strong>Scenario:</strong></label>
                <select id="scenarioNum"></select>
                <button class="btn btn-secondary" onclick="loadPracticeScenario()">Load</button>
            </div>
            <div id="practiceScenarioBox" style="margin-top:16px;"></div>
        </div>
        <!-- Schedule Simulator Tab -->
        <div id="simulator" class="content">
            <h2>Schedule Simulator</h2>
            <div>
                <label for="simDay"><strong>Select Day:</strong></label>
                <select id="simDay"></select>
                <label for="simScenario"><strong>Scenario:</strong></label>
                <select id="simScenario"></select>
                <button class="btn btn-secondary" onclick="loadSimulatorScenario()">Load</button>
                <button class="btn btn-secondary" onclick="clearSchedule()">Clear</button>
            </div>
            <div id="addMassagePanel" style="margin-bottom:24px;">
                <strong>Add Massage:</strong>
                <div style="display:flex; gap:10px; margin-top:8px;">
                    <div class="time-slot booked-80" draggable="true" ondragstart="dragStart(event)" data-type="booked_80">80m</div>
                    <div class="time-slot booked-50" draggable="true" ondragstart="dragStart(event)" data-type="booked_50">50m</div>
                </div>
            </div>
            <div class="score-panel">
                <div class="stat-card">
                    <div class="stat-value" id="movesCount">0</div>
                    <div class="stat-label">Moves</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="gapsFixedCount">0</div>
                    <div class="stat-label">Gaps Fixed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="revenueSaved">$0</div>
                    <div class="stat-label">Revenue Saved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="gradeValue">C</div>
                    <div class="stat-label">Grade</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="utilizationRate">0%</div>
                <div class="stat-label">Utilization Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="gapCount">0</div>
                <div class="stat-label">Gaps</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="optimalPatterns">0</div>
                <div class="stat-label">Optimal Patterns</div>
            </div>
            <div id="hintBox" class="hint-box" style="display:none;"></div>
            <div class="controls">
                <button class="btn btn-secondary" onclick="showHint()">Hint</button>
                <button id="showSolutionBtn" class="btn btn-primary" onclick="showSolution()" disabled>Show Solution</button>
                <button class="btn btn-secondary" onclick="nextSimulatorScenario()">Next Scenario</button>
            </div>
            <div class="schedule-grid" id="scheduleGrid"></div>
        </div>
    </div>
<script>
/* ---- CONFIG ---- */
const BUSINESS_HOURS = {
  sunday:    { open: "9:00", close: "20:00" },
  monday:    { open: "9:00", close: "20:00" },
  tuesday:   { open: "9:00", close: "20:00" },
  wednesday: { open: "9:00", close: "20:00" },
  thursday:  { open: "9:00", close: "20:00" },
  friday:    { open: "9:00", close: "21:00" },
  saturday:  { open: "9:00", close: "21:00" }
};
const BLOCK_TYPES = {
    "booked_80": {label: "80m", colorclass: "booked-80"},
    "booked_50": {label: "50m", colorclass: "booked-50"},
    "gap": {label: "GAP", colorclass: "gap"},
    "open": {label: "OPEN", colorclass: "open"},
    "break": {label: "Break", colorclass: "break"},
    "lunch": {label: "Lunch", colorclass: "lunch"},
    "callout": {label: "Call-out", colorclass: "callout"},
    "shift_adj": {label: "Shift Adj.", colorclass: "callout"},
    "requested_off": {label: "Req. Off", colorclass: "lunch"}
};

/* ---- Generate Time Slot Array ---- */
function generateTimeSlots(day) {
    let times = [];
    let hours = BUSINESS_HOURS[day];
    let [openH, openM] = hours.open.split(':').map(Number);
    let [closeH, closeM] = hours.close.split(':').map(Number);
    let dt = new Date(2020,0,1,openH,openM);
    let end = new Date(2020,0,1,closeH,closeM);
    while(dt < end) {
        let s = dt.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
        times.push(s);
        dt.setMinutes(dt.getMinutes()+30);
    }
    return times;
}

/* ---- Realistic Therapist Lists for Each Day ---- */
const THERAPISTS_REAL = {
  sunday: ["Aaron", "Amy", "Bill", "Gaia", "Hank", "Marti", "Seydonia", "Spencer", "Trang", "Alexis", "Jose", "Crawford"],
  monday: ["Amy", "Bill", "Frankie", "Marti", "Trang", "Vicente", "Victor", "Hank", "Jose", "Alexis", "Diaz", "Gaia", "Jayna", "Jon", "Sean"],
  tuesday: ["Jayna", "Jose", "Yari", "Carl", "Ryan", "Alexis", "Seydonia", "Hank", "Victor", "Aaron"],
  wednesday: ["Amy", "Jayna", "Spencer", "Trang", "Alexis", "Hank", "Bill", "Corey", "Diaz", "Frankie", "Yari"]
};

/* ---- Real-Life and Mixed Scenarios (example placeholder, add your real scenarios here) ---- */
const ALL_SCENARIOS = {
    sunday: [
        {
            name: "Sunday Example",
            description: "Fill all late gaps and stagger breaks/lunches.",
            therapists: THERAPISTS_REAL.sunday,
            schedule: Array(THERAPISTS_REAL.sunday.length).fill(0).map((_,i)=>({
                therapist: THERAPISTS_REAL.sunday[i],
                slots: Array(24).fill(i%2==0?'booked_80':'open')
            })),
            correctMoves: ["Stagger breaks.", "Fill gaps in late slots.", "Limit callouts."],
            incorrectMoves: ["All breaks at once.", "Leaving late gaps."]
        }
    ],
    monday: [
        {
            name: "Monday Example",
            description: "Lunches and breaks must be staggered and no overlap.",
            therapists: THERAPISTS_REAL.monday,
            schedule: Array(THERAPISTS_REAL.monday.length).fill(0).map((_,i)=>({
                therapist: THERAPISTS_REAL.monday[i],
                slots: Array(24).fill(i%3==0?'lunch':i%2==0?'booked_80':'open')
            })),
            correctMoves: ["Stagger lunch times.", "No more than 2 on break at once."],
            incorrectMoves: ["Lunch overlap.", "Gaps not filled."]
        }
    ],
    tuesday: [
        {
            name: "Tuesday Example",
            description: "Mix of breaks and late bookings.",
            therapists: THERAPISTS_REAL.tuesday,
            schedule: Array(THERAPISTS_REAL.tuesday.length).fill(0).map((_,i)=>({
                therapist: THERAPISTS_REAL.tuesday[i],
                slots: Array(24).fill(i%4==0?'break':i%2==0?'booked_80':'open')
            })),
            correctMoves: ["Fill late slots.", "Breaks staggered."],
            incorrectMoves: ["Break overlap.", "Empty late slots."]
        }
    ],
    wednesday: [
        {
            name: "Wednesday Example",
            description: "Callouts and optimal coverage.",
            therapists: THERAPISTS_REAL.wednesday,
            schedule: Array(THERAPISTS_REAL.wednesday.length).fill(0).map((_,i)=>({
                therapist: THERAPISTS_REAL.wednesday[i],
                slots: Array(24).fill(i%5==0?'callout':i%2==0?'booked_80':'open')
            })),
            correctMoves: ["Reassign callouts.", "Fill gaps late day."],
            incorrectMoves: ["Unfilled callouts.", "Lunch overlap."]
        }
    ]
};

const DAY_LIST = Object.keys(BUSINESS_HOURS);
function capitalize(str) {return str.charAt(0).toUpperCase()+str.slice(1);}
function showTab(tab){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
    document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
    document.getElementById(tab).classList.add('active');
    if(tab==="scenarios")renderScenarioControls();
    if(tab==="simulator")renderSimulatorControls();
}
function renderScenarioControls(){
    let daySel=document.getElementById('scenarioDay');
    let scenSel=document.getElementById('scenarioNum');
    daySel.innerHTML=DAY_LIST.map(d=>`<option value="${d}">${capitalize(d)}</option>`).join('');
    let scens=ALL_SCENARIOS[DAY_LIST[0]];
    scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    daySel.onchange=function(){
        let scens=ALL_SCENARIOS[daySel.value];
        scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    };
}
function loadPracticeScenario(){
    let day=document.getElementById('scenarioDay').value;
    let idx=+document.getElementById('scenarioNum').value;
    let scenario=ALL_SCENARIOS[day][idx];
    let box=document.getElementById('practiceScenarioBox');
    box.innerHTML=`
        <h3>${scenario.name}</h3>
        <div>${scenario.description}</div>
        <div class="hint-box"><strong>Optimal Solution:</strong><br>${scenario.correctMoves.join('<br>')}</div>
        <div style="background:#ffe4c2;border-radius:8px;padding:10px;margin-top:8px;"><strong>Avoid:</strong><br>${scenario.incorrectMoves.join('<br>')}</div>
    `;
}
function renderSimulatorControls(){
    let daySel=document.getElementById('simDay');
    let scenSel=document.getElementById('simScenario');
    daySel.innerHTML=DAY_LIST.map(d=>`<option value="${d}">${capitalize(d)}</option>`).join('');
    let scens=ALL_SCENARIOS[DAY_LIST[0]];
    scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    daySel.onchange=function(){
        let scens=ALL_SCENARIOS[daySel.value];
        scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    };
}
let moves=0;
let userAttempts=0;
let solutionShown=false;
function registerUserAttempt() {
    userAttempts++;
    updateShowSolutionButton();
}
function loadSimulatorScenario(){
    let day=document.getElementById('simDay').value;
    let idx=+document.getElementById('simScenario').value;
    let scenario=ALL_SCENARIOS[day][idx];
    renderScheduleGrid(day,scenario);
    moves=0;
    userAttempts=0;
    solutionShown=false;
    document.getElementById('movesCount').textContent=moves;
    updateShowSolutionButton();
    removeSolutionHighlights();
    hideHint();
}
function clearSchedule(){
    let day=document.getElementById('simDay').value;
    let times=generateTimeSlots(day);
    let grid=document.getElementById('scheduleGrid');
    let therapists=THERAPISTS_REAL[day];
    grid.innerHTML='';
    grid.innerHTML+=`<div class="time-slot header">Time</div>`;
    therapists.forEach(t=>grid.innerHTML+=`<div class="time-slot header">${t}</div>`);
    for(let t=0;t<times.length;t++){
        grid.innerHTML+=`<div class="time-slot time-header">${times[t]}</div>`;
        for(let i=0;i<therapists.length;i++){
            grid.innerHTML+=`<div class="time-slot open" data-type="open" data-tidx="${i}" data-time="${times[t]}" data-slot-id="${t+'-'+i}" draggable="true" ondragstart="slotDragStart(event)" ondragover="allowDrop(event)" ondrop="dropSlot(event)" onclick="toggleSlot(this)"></div>`;
        }
    }
    moves=0;
    userAttempts=0;
    solutionShown=false;
    updateShowSolutionButton();
    removeSolutionHighlights();
}
function nextSimulatorScenario(){
    let daySel=document.getElementById('simDay');
    let scenSel=document.getElementById('simScenario');
    let day=daySel.value;
    let idx=+scenSel.value;
    let scens=ALL_SCENARIOS[day];
    idx=(idx+1)%scens.length;
    scenSel.value=idx;
    loadSimulatorScenario();
}
function showHint(){
    let box=document.getElementById('hintBox');
    box.style.display="block";
    box.textContent="Tip: Drag appointments to fill gaps, focus on late day coverage!";
}
function hideHint(){
    let box=document.getElementById('hintBox');
    box.style.display="none";
}
function updateShowSolutionButton() {
    const btn = document.getElementById('showSolutionBtn');
    btn.disabled = userAttempts < 2;
}
function showSolution() {
    if (userAttempts < 2) return;
    solutionShown = true;
    highlightSolutionCells();
}
function highlightSolutionCells() {
    removeSolutionHighlights();
    // Get current scenario
    let day = document.getElementById('simDay').value;
    let idx = +document.getElementById('simScenario').value;
    let scenario = ALL_SCENARIOS[day][idx];
    // Highlight logic (hybrid: simple for easy, scenario-specific for hard)
    scenario.schedule.forEach((therapistBlock, colIdx) => {
        therapistBlock.slots.forEach((slotType, rowIdx) => {
            if (isOptimalCell(slotType, rowIdx, colIdx, therapistBlock, scenario)) {
                let slotEl = document.querySelector(`[data-slot-id="${rowIdx+'-'+colIdx}"]`);
                if (slotEl) slotEl.classList.add('solution-highlight');
            }
        });
    });
}
function removeSolutionHighlights() {
    document.querySelectorAll('.solution-highlight').forEach(el => el.classList.remove('solution-highlight'));
}

// Logic for "solution" cells. You can expand this as needed.
function isOptimalCell(slotType, rowIdx, colIdx, therapistBlock, scenario) {
    // Simple logic: highlight booked_80, filled gaps
    if (scenario.name.toLowerCase().includes("easy") || scenario.name.toLowerCase().includes("different case")) {
        return slotType === 'booked_80' || slotType === 'gap' && rowIdx > 12; // gaps late day
    }
    // Intermediate: highlight staggered breaks/lunches (no overlap)
    if (scenario.name.toLowerCase().includes("lunch wave")) {
        // Check if this break/lunch is not overlapping (max 1 lunch per time)
        let count = 0;
        scenario.schedule.forEach(tb => {
            if (tb.slots[rowIdx] === "lunch") count++;
        });
        return slotType === "lunch" && count === 1;
    }
    // Advanced: scenario-specific, e.g. callouts, shift, late day bookings
    if (scenario.name.toLowerCase().includes("callout")) {
        return slotType === "booked_80" && rowIdx > 15 || slotType === "callout";
    }
    // Default: booked_80, filled gaps
    return slotType === 'booked_80';
}

/* ---- Drag-and-Drop Logic ---- */
let draggedType=null;
let draggedSlot=null;
function dragStart(e){
    draggedType=e.target.dataset.type;
    draggedSlot=null;
    e.dataTransfer.effectAllowed="move";
}
function allowDrop(e){e.preventDefault();}
function dropSlot(e){
    e.preventDefault();
    let slot=e.target;
    if(draggedType){
        slot.dataset.type=draggedType;
        slot.className="time-slot "+(BLOCK_TYPES[draggedType]?.colorclass||"");
        slot.textContent=BLOCK_TYPES[draggedType]?.label||"";
        moves++;
        registerUserAttempt();
        document.getElementById('movesCount').textContent=moves;
        hideHint();
        draggedType=null;
        draggedSlot=null;
        updateScheduleStats();
        return;
    }
    if(draggedSlot){
        let fromSlot=document.querySelector(`[data-slot-id='${draggedSlot}']`);
        let tempType=slot.dataset.type;
        let tempLabel=slot.textContent;
        let tempClass=slot.className;
        slot.dataset.type=fromSlot.dataset.type;
        slot.className=fromSlot.className;
        slot.textContent=fromSlot.textContent;
        fromSlot.dataset.type=tempType;
        fromSlot.className=tempClass;
        fromSlot.textContent=tempLabel;
        moves++;
        registerUserAttempt();
        document.getElementById('movesCount').textContent=moves;
        hideHint();
        draggedType=null;
        draggedSlot=null;
        updateScheduleStats();
        return;
    }
}
function slotDragStart(e){
    draggedType=e.target.dataset.type;
    draggedSlot=e.target.dataset.slotId;
    e.dataTransfer.effectAllowed="move";
}
/* ---- Click to cycle slot type ---- */
const CYCLE_TYPES=["open","booked_80","booked_50","gap","break","lunch","callout","shift_adj","requested_off"];
function toggleSlot(slot){
    let cur=slot.dataset.type||"open";
    let idx=CYCLE_TYPES.indexOf(cur);
    let nextType=CYCLE_TYPES[(idx+1)%CYCLE_TYPES.length];
    slot.dataset.type=nextType;
    slot.className="time-slot "+(BLOCK_TYPES[nextType]?.colorclass||"");
    slot.textContent=BLOCK_TYPES[nextType]?.label||"";
    moves++;
    registerUserAttempt();
    document.getElementById('movesCount').textContent=moves;
    hideHint();
    updateScheduleStats();
}
/* ---- Render Schedule Grid ---- */
function renderScheduleGrid(day,scenario){
    let times=generateTimeSlots(day);
    let grid=document.getElementById('scheduleGrid');
    let therapists=scenario.therapists;
    grid.innerHTML='';
    grid.innerHTML+=`<div class="time-slot header">Time</div>`;
    therapists.forEach(t=>grid.innerHTML+=`<div class="time-slot header">${t}</div>`);
    let slotId=0;
    for(let t=0;t<times.length;t++){
        grid.innerHTML+=`<div class="time-slot time-header">${times[t]}</div>`;
        for(let i=0;i<therapists.length;i++){
            let type=(scenario.schedule[i]&&scenario.schedule[i].slots[t])||'open';
            let block=BLOCK_TYPES[type]||{label:"",colorclass:""};
            grid.innerHTML+=`<div class="time-slot ${block.colorclass}" data-type="${type}" data-tidx="${i}" data-time="${times[t]}" data-slot-id="${t+'-'+i}" draggable="true" ondragstart="slotDragStart(event)" ondragover="allowDrop(event)" ondrop="dropSlot(event)" onclick="toggleSlot(this)">${block.label||""}</div>`;
            slotId++;
        }
    }
    updateScheduleStats();
    removeSolutionHighlights();
}
/* ---- Schedule Stats ---- */
function updateScheduleStats(){
    let slots=document.querySelectorAll('.schedule-grid .time-slot:not(.header):not(.time-header)');
    let booked=0,gaps=0,open=0,optimal=0;
    slots.forEach(s=>{
        let type=s.dataset.type;
        if(type==="open")open++;
        if(type==="gap")gaps++;
        if(type&&type.startsWith("booked"))booked++;
        if(type==="booked_80"||type==="booked_50")optimal++;
    });
    let total=slots.length;
    let utilization=Math.round(100*booked/total);
    document.getElementById('utilizationRate').textContent=utilization+"%";
    document.getElementById('gapCount').textContent=gaps;
    document.getElementById('optimalPatterns').textContent=optimal;
    document.getElementById('gapsFixedCount').textContent=gaps===0?"All":(total-gaps);
    document.getElementById('revenueSaved').textContent="$"+(booked*120);
    document.getElementById('gradeValue').textContent=utilization>80&&gaps===0?"A":utilization>70?"B":"C";
}
/* ---- INIT ---- */
window.onload=function(){
    showTab('overview');
    renderScenarioControls();
    renderSimulatorControls();
    updateShowSolutionButton();
};
</script>
</body>
</html>
