<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Schedule Optimization Training</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fd; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px #eee; padding: 32px; }
    h1 { color: #6170f7; font-size: 2.8em; margin-bottom: 0.5em; }
    .subtitle { color: #333; font-size: 1.2em; margin-bottom: 2rem; }
    .scenario-bar { display: flex; gap: 16px; margin-bottom: 14px; }
    .scenario-label { font-weight: 600; color: #6170f7; }
    select, button { font-size: 1em; padding: 8px 16px; border-radius: 6px; border: 1px solid #dbe2fa; margin-right: 10px; }
    button { background: #eef3ff; color: #6170f7; font-weight: 700; border: none; margin-top: 8px; cursor: pointer;}
    button.active, button:active { background: #dbe2fa; }
    button:disabled { background: #eee; color: #999; }
    .metrics { display: flex; gap: 32px; margin: 1.6em 0 1em 0;}
    .metric { background: #f7f3fb; border-radius: 8px; padding: 18px; text-align: center; min-width: 120px; }
    .metric-value { font-size: 2em; color: #6170f7; font-weight: bold; }
    .metric-label { font-size: 1em; color: #555; margin-top: 6px; }
    .metric-grade { font-size: 1.5em; font-weight: bold; color: #789f42;}
    .scenario-description { background: #f8faff; border-radius: 6px; padding: 18px; margin: 14px 0 20px 0; color: #425b89; font-size: 1.1em;}
    table.schedule-table { border-collapse: collapse; width: 100%; margin-top: 18px;}
    table.schedule-table th { background: #6170f7; color: #fff; padding: 10px; border-bottom: 2px solid #dbe2fa;}
    table.schedule-table td { background: #fff; border: 1px solid #dbe2fa; padding: 8px 0; text-align: center; font-size: 1em;}
    .schedule-block-open { background: #fdf3cf; color: #7b950f; font-weight: bold; cursor: pointer;}
    .schedule-block-session { background: #dbe2fa; color: #3269b7; font-weight: bold;}
    .schedule-block-callout { background: #fcdbdb; color: #c32929; font-weight: bold;}
    .schedule-block-lunch { background: #f3db9b; color: #b56c21; font-weight: bold;}
    .schedule-block-gap { background: #ffe5e5; color: #c32929; font-weight: bold;}
    .solution-toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); background: #f8f2ff; border: 2px solid #dbe2fa; color: #6170f7; border-radius: 10px; padding: 18px 38px; font-size: 1.3em; font-weight: 700; box-shadow: 0 2px 8px #e3e2fd; display: none; z-index: 1000;}
    .feedback-box { margin-top: 22px; background: #fffbe9; border-left: 6px solid #f3c161; padding: 18px 24px; border-radius: 7px; color: #86612c; font-size: 1.07em;}
    @media (max-width: 900px) {
      .container { padding: 10px; }
      table.schedule-table th, table.schedule-table td { padding: 6px 2px; font-size: .88em;}
      .metrics { gap: 10px; }
      .metric { padding: 12px; min-width: 80px;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Schedule Optimization Training</h1>
  <div class="subtitle">Interactive simulator: Fix gaps, maximize utilization, and compare your solution to the optimal schedule!</div>
  <div class="scenario-bar">
    <span class="scenario-label">Select Day:</span>
    <select id="daySelect"></select>
    <span class="scenario-label">Scenario:</span>
    <select id="scenarioSelect"></select>
    <button onclick="resetProgress()">Reset Progress</button>
    <button onclick="showSolution()">Show Solution</button>
    <button onclick="nextScenario()">Next Scenario</button>
  </div>
  <div class="scenario-description" id="scenarioDescription"></div>
  <div class="metrics">
    <div class="metric"><span class="metric-value" id="movesMetric">0</span><div class="metric-label">Moves</div></div>
    <div class="metric"><span class="metric-value" id="gapsMetric">0</span><div class="metric-label">Gaps Fixed</div></div>
    <div class="metric"><span class="metric-value" id="utilMetric">0%</span><div class="metric-label">Utilization</div></div>
    <div class="metric"><span class="metric-value" id="revenueMetric">$0</span><div class="metric-label">Revenue Saved</div></div>
    <div class="metric"><span class="metric-grade" id="gradeMetric">C</span><div class="metric-label">Grade</div></div>
  </div>
  <div id="feedbackBox"></div>
  <table class="schedule-table" id="scheduleTable"></table>
</div>
<div class="solution-toast" id="solutionToast">Optimal solution loaded.</div>
<script>
const therapistList = ["Gaia", "Jose", "Diaz", "Frankie"];
const sessionPrice = 80; // per session slot
const lunchPrice = 0;
const calloutPrice = -60; // cost of call-out (lost revenue)
const openPrice = 0;

// Custom hours for each day
const dayHours = {
  "Sunday":   {start: 9, end: 20},
  "Monday":   {start: 9, end: 20},
  "Tuesday":  {start: 9, end: 20},
  "Wednesday":{start: 9, end: 20},
  "Thursday": {start: 9, end: 20},
  "Friday":   {start: 9, end: 21},
  "Saturday": {start: 9, end: 21}
};

// Build time slots for a given day
function buildTimes(day) {
  let times = [];
  let start = dayHours[day].start, end = dayHours[day].end;
  for (let h = start; h <= end; h++) {
    times.push((h < 12 ? h : h<=12?12:h-12) + ':00 ' + (h<12?'AM':h==12?'PM':'PM'));
    times.push((h < end) ? ((h < 12 ? h : h<=12?12:h-12) + ':30 ' + (h<12?'AM':h==12?'PM':'PM')) : null);
  }
  return times.filter(x=>x);
}

// Scenario data for each day
const scenarioData = {
  "Sunday": [
    {
      name: "Fill Gaps & Align Lunch",
      description: "Gaia has gaps in the morning, Jose has back-to-back sessions, Diaz has a call-out in the afternoon. Goal: Fill Gaia's gaps, align all lunch breaks.",
      problem: [
        // therapist blocks for each time slot
        // Gaia, Jose, Diaz, Frankie
        ["OPEN","OPEN","OPEN","OPEN"], //9:00 AM
        ["OPEN","80m","OPEN","OPEN"], //9:30 AM
        ["80m","80m","OPEN","OPEN"], //10:00 AM
        ["Lunch","80m","OPEN","OPEN"], //10:30 AM
        ["OPEN","OPEN","OPEN","OPEN"], //11:00 AM
        ["OPEN","OPEN","OPEN","OPEN"], //11:30 AM
        ["80m","OPEN","Call-out","OPEN"], //12:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //12:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //8:00 PM
      ],
      solution: [
        ["80m","80m","80m","80m"], //9:00 AM
        ["80m","80m","80m","80m"], //9:30 AM
        ["Lunch","Lunch","Lunch","Lunch"], //10:00 AM
        ["80m","80m","80m","80m"], //10:30 AM
        ["80m","80m","80m","80m"], //11:00 AM
        ["80m","80m","80m","80m"], //11:30 AM
        ["80m","80m","80m","80m"], //12:00 PM
        ["80m","80m","80m","80m"], //12:30 PM
        ["80m","80m","80m","80m"], //1:00 PM
        ["80m","80m","80m","80m"], //1:30 PM
        ["80m","80m","80m","80m"], //2:00 PM
        ["80m","80m","80m","80m"], //2:30 PM
        ["80m","80m","80m","80m"], //3:00 PM
        ["80m","80m","80m","80m"], //3:30 PM
        ["80m","80m","80m","80m"], //4:00 PM
        ["80m","80m","80m","80m"], //4:30 PM
        ["80m","80m","80m","80m"], //5:00 PM
        ["80m","80m","80m","80m"], //5:30 PM
        ["80m","80m","80m","80m"], //6:00 PM
        ["80m","80m","80m","80m"], //6:30 PM
        ["80m","80m","80m","80m"], //7:00 PM
        ["80m","80m","80m","80m"], //7:30 PM
        ["80m","80m","80m","80m"], //8:00 PM
      ]
    },
    {
      name: "No-Show Call-Outs",
      description: "Multiple call-outs and open slots. Goal: Rearrange sessions to minimize revenue loss from call-outs.",
      problem: [
        ["80m","OPEN","Call-out","OPEN"], //9:00 AM
        ["OPEN","OPEN","OPEN","OPEN"], //9:30 AM
        ["OPEN","OPEN","OPEN","Call-out"], //10:00 AM
        ["OPEN","80m","OPEN","OPEN"], //10:30 AM
        ["OPEN","OPEN","OPEN","OPEN"], //11:00 AM
        ["OPEN","OPEN","OPEN","OPEN"], //11:30 AM
        ["OPEN","OPEN","OPEN","OPEN"], //12:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //12:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //8:00 PM
      ],
      solution: [
        ["80m","80m","80m","80m"], //9:00 AM
        ["80m","80m","80m","80m"], //9:30 AM
        ["Lunch","Lunch","Lunch","Lunch"], //10:00 AM
        ["80m","80m","80m","80m"], //10:30 AM
        ["80m","80m","80m","80m"], //11:00 AM
        ["80m","80m","80m","80m"], //11:30 AM
        ["80m","80m","80m","80m"], //12:00 PM
        ["80m","80m","80m","80m"], //12:30 PM
        ["80m","80m","80m","80m"], //1:00 PM
        ["80m","80m","80m","80m"], //1:30 PM
        ["80m","80m","80m","80m"], //2:00 PM
        ["80m","80m","80m","80m"], //2:30 PM
        ["80m","80m","80m","80m"], //3:00 PM
        ["80m","80m","80m","80m"], //3:30 PM
        ["80m","80m","80m","80m"], //4:00 PM
        ["80m","80m","80m","80m"], //4:30 PM
        ["80m","80m","80m","80m"], //5:00 PM
        ["80m","80m","80m","80m"], //5:30 PM
        ["80m","80m","80m","80m"], //6:00 PM
        ["80m","80m","80m","80m"], //6:30 PM
        ["80m","80m","80m","80m"], //7:00 PM
        ["80m","80m","80m","80m"], //7:30 PM
        ["80m","80m","80m","80m"], //8:00 PM
      ]
    }
  ],
  // Repeat similar structure for Monday to Saturday
  "Monday": [
    {
      name: "Misaligned Breaks",
      description: "Therapists have breaks at different times, causing scheduling inefficiency. Goal: Align lunch breaks and fill gaps.",
      problem: [
        ["80m","OPEN","OPEN","OPEN"], //9:00 AM
        ["OPEN","80m","OPEN","OPEN"], //9:30 AM
        ["OPEN","OPEN","80m","OPEN"], //10:00 AM
        ["OPEN","OPEN","OPEN","80m"], //10:30 AM
        ["Lunch","OPEN","OPEN","OPEN"], //11:00 AM
        ["OPEN","Lunch","OPEN","OPEN"], //11:30 AM
        ["OPEN","OPEN","Lunch","OPEN"], //12:00 PM
        ["OPEN","OPEN","OPEN","Lunch"], //12:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //8:00 PM
      ],
      solution: [
        ["80m","80m","80m","80m"], //9:00 AM
        ["80m","80m","80m","80m"], //9:30 AM
        ["Lunch","Lunch","Lunch","Lunch"], //10:00 AM
        ["80m","80m","80m","80m"], //10:30 AM
        ["80m","80m","80m","80m"], //11:00 AM
        ["80m","80m","80m","80m"], //11:30 AM
        ["80m","80m","80m","80m"], //12:00 PM
        ["80m","80m","80m","80m"], //12:30 PM
        ["80m","80m","80m","80m"], //1:00 PM
        ["80m","80m","80m","80m"], //1:30 PM
        ["80m","80m","80m","80m"], //2:00 PM
        ["80m","80m","80m","80m"], //2:30 PM
        ["80m","80m","80m","80m"], //3:00 PM
        ["80m","80m","80m","80m"], //3:30 PM
        ["80m","80m","80m","80m"], //4:00 PM
        ["80m","80m","80m","80m"], //4:30 PM
        ["80m","80m","80m","80m"], //5:00 PM
        ["80m","80m","80m","80m"], //5:30 PM
        ["80m","80m","80m","80m"], //6:00 PM
        ["80m","80m","80m","80m"], //6:30 PM
        ["80m","80m","80m","80m"], //7:00 PM
        ["80m","80m","80m","80m"], //7:30 PM
        ["80m","80m","80m","80m"], //8:00 PM
      ]
    },
    {
      name: "Late Evening Gaps",
      description: "Several open slots in the evening. Goal: Fill late gaps and maximize utilization.",
      problem: [
        ["80m","80m","80m","80m"], //9:00 AM
        ["80m","80m","80m","80m"], //9:30 AM
        ["Lunch","Lunch","Lunch","Lunch"], //10:00 AM
        ["80m","80m","80m","80m"], //10:30 AM
        ["80m","80m","80m","80m"], //11:00 AM
        ["80m","80m","80m","80m"], //11:30 AM
        ["80m","80m","80m","80m"], //12:00 PM
        ["80m","80m","80m","80m"], //12:30 PM
        ["80m","80m","80m","80m"], //1:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //1:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //2:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //3:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //4:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //5:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //6:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:00 PM
        ["OPEN","OPEN","OPEN","OPEN"], //7:30 PM
        ["OPEN","OPEN","OPEN","OPEN"], //8:00 PM
      ],
      solution: [
        ["80m","80m","80m","80m"], //9:00 AM
        ["80m","80m","80m","80m"], //9:30 AM
        ["Lunch","Lunch","Lunch","Lunch"], //10:00 AM
        ["80m","80m","80m","80m"], //10:30 AM
        ["80m","80m","80m","80m"], //11:00 AM
        ["80m","80m","80m","80m"], //11:30 AM
        ["80m","80m","80m","80m"], //12:00 PM
        ["80m","80m","80m","80m"], //12:30 PM
        ["80m","80m","80m","80m"], //1:00 PM
        ["80m","80m","80m","80m"], //1:30 PM
        ["80m","80m","80m","80m"], //2:00 PM
        ["80m","80m","80m","80m"], //2:30 PM
        ["80m","80m","80m","80m"], //3:00 PM
        ["80m","80m","80m","80m"], //3:30 PM
        ["80m","80m","80m","80m"], //4:00 PM
        ["80m","80m","80m","80m"], //4:30 PM
        ["80m","80m","80m","80m"], //5:00 PM
        ["80m","80m","80m","80m"], //5:30 PM
        ["80m","80m","80m","80m"], //6:00 PM
        ["80m","80m","80m","80m"], //6:30 PM
        ["80m","80m","80m","80m"], //7:00 PM
        ["80m","80m","80m","80m"], //7:30 PM
        ["80m","80m","80m","80m"], //8:00 PM
      ]
    }
  ],
  // ...Repeat for Tuesday through Saturday (for brevity, these can be clones of the above, or you can specify differences)
  // For demonstration, use Sunday/Monday scenarios for other days. You can expand as needed!
};
["Tuesday","Wednesday","Thursday","Friday","Saturday"].forEach(day=>{
  scenarioData[day] = JSON.parse(JSON.stringify(scenarioData["Sunday"]));
  scenarioData[day][0].name = "Fill Gaps & Align Lunch";
  scenarioData[day][1].name = "No-Show Call-Outs";
  scenarioData[day][0].description = "Gaia has gaps in the morning, Jose has back-to-back sessions, Diaz has a call-out in the afternoon. Goal: Fill Gaia's gaps, align all lunch breaks.";
  scenarioData[day][1].description = "Multiple call-outs and open slots. Goal: Rearrange sessions to minimize revenue loss from call-outs.";
});

let currentDay = "Sunday";
let currentScenarioIdx = 0;
let currentState = null;
let moveCount = 0;

function updateScenarioBar() {
  const daySelect = document.getElementById('daySelect');
  daySelect.innerHTML = Object.keys(scenarioData).map(d=>`<option value="${d}">${d}</option>`).join('');
  daySelect.value = currentDay;
  daySelect.onchange = function() {
    currentDay = daySelect.value;
    currentScenarioIdx = 0;
    resetProgress();
  };
  const scenarioSelect = document.getElementById('scenarioSelect');
  scenarioSelect.innerHTML = scenarioData[currentDay].map((s,idx)=>`<option value="${idx}">${s.name}</option>`).join('');
  scenarioSelect.value = currentScenarioIdx;
  scenarioSelect.onchange = function() {
    currentScenarioIdx = parseInt(scenarioSelect.value);
    resetProgress();
  };
}

function resetProgress() {
  moveCount = 0;
  currentState = null;
  renderScenario();
  hideToast();
}

function nextScenario() {
  currentScenarioIdx = (currentScenarioIdx+1) % scenarioData[currentDay].length;
  resetProgress();
}

function showSolution() {
  currentState = JSON.parse(JSON.stringify(scenarioData[currentDay][currentScenarioIdx].solution));
  moveCount = 0;
  renderScenario();
  showToast("Optimal solution loaded.");
}

function showToast(text) {
  const toast = document.getElementById('solutionToast');
  toast.textContent = text;
  toast.style.display = "block";
  setTimeout(hideToast, 1800);
}
function hideToast() {
  document.getElementById('solutionToast').style.display = "none";
}

function renderScenario() {
  updateScenarioBar();
  const scenario = scenarioData[currentDay][currentScenarioIdx];
  document.getElementById('scenarioDescription').textContent = scenario.description;

  const times = buildTimes(currentDay);
  const table = document.getElementById('scheduleTable');
  table.innerHTML = '';
  // Header
  let thead = document.createElement('thead');
  let hRow = document.createElement('tr');
  hRow.innerHTML = `<th>Time</th>` + therapistList.map(n=>`<th>${n}</th>`).join('');
  thead.appendChild(hRow);
  table.appendChild(thead);

  // Body
  let tbody = document.createElement('tbody');
  let state = currentState || scenario.problem;
  for (let i=0; i<times.length; i++) {
    let row = document.createElement('tr');
    row.innerHTML = `<td>${times[i]}</td>`;
    for (let t=0; t<therapistList.length; t++) {
      let val = (state[i]&&state[i][t]) ? state[i][t] : "OPEN";
      let cellClass = "schedule-block-open";
      if (val==="80m") cellClass = "schedule-block-session";
      if (val==="Lunch") cellClass = "schedule-block-lunch";
      if (val==="Call-out") cellClass = "schedule-block-callout";
      if (val==="GAP") cellClass = "schedule-block-gap";
      row.innerHTML += `<td class="${cellClass}" 
        draggable="true" ondragstart="dragCell(event,${i},${t})" 
        ondrop="dropCell(event,${i},${t})" ondragover="event.preventDefault()">
        ${val}
        </td>`;
    }
    tbody.appendChild(row);
  }
  table.appendChild(tbody);

  // Metrics
  updateMetrics(state, scenario.solution);

  // Feedback
  renderFeedback(state, scenario.solution);
}

function dragCell(e,i,t) {
  e.dataTransfer.setData("text/plain", JSON.stringify({i,t}));
}
function dropCell(e,i2,t2) {
  let data = e.dataTransfer.getData("text/plain");
  if (!data) return;
  let {i: i1, t: t1} = JSON.parse(data);
  if (i1==i2 && t1==t2) return;
  let scenario = scenarioData[currentDay][currentScenarioIdx];
  let times = buildTimes(currentDay);
  let state = currentState || JSON.parse(JSON.stringify(scenario.problem));
  // Swap cells
  let tmp = state[i1][t1];
  state[i1][t1] = state[i2][t2];
  state[i2][t2] = tmp;
  currentState = state;
  moveCount++;
  renderScenario();
}

function updateMetrics(state, solution) {
  // Moves
  document.getElementById('movesMetric').textContent = moveCount;
  // Gaps fixed = number of non-OPEN blocks in state minus problem
  let gapsFixed = 0;
  for (let i=0;i<state.length;i++) {
    for (let t=0;t<therapistList.length;t++) {
      if (state[i][t]!=="OPEN" && scenarioData[currentDay][currentScenarioIdx].problem[i][t]==="OPEN") {
        gapsFixed++;
      }
    }
  }
  document.getElementById('gapsMetric').textContent = gapsFixed;
  // Utilization = percent of slots filled (not OPEN)
  let filled = 0, total = state.length*therapistList.length;
  for (let i=0;i<state.length;i++) for (let t=0;t<therapistList.length;t++) {
    if (state[i][t]!=="OPEN") filled++;
  }
  let utilization = Math.round(100*filled/total);
  document.getElementById('utilMetric').textContent = utilization+"%";
  // Revenue Saved = (number of 80m blocks in state) * price, minus call-outs
  let revenue = 0;
  for (let i=0;i<state.length;i++) for (let t=0;t<therapistList.length;t++) {
    if (state[i][t]==="80m") revenue += sessionPrice;
    if (state[i][t]==="Call-out") revenue += calloutPrice;
  }
  document.getElementById('revenueMetric').textContent = "$"+revenue;
  // Grade
  let grade = "C";
  if (utilization > 90) grade = "A";
  else if (utilization > 75) grade = "B";
  else if (utilization > 60) grade = "C";
  else grade = "D";
  document.getElementById('gradeMetric').textContent = grade;
}

function renderFeedback(state, solution) {
  // List missed slots (OPEN), call-outs, and gaps
  let missed = 0, callouts = 0;
  let feedback = "<div class='feedback-box'><b>Feedback:</b><ul>";
  for (let i=0;i<state.length;i++) for (let t=0;t<therapistList.length;t++) {
    if (state[i][t]==="OPEN") {
      feedback += `<li>Missed opportunity at ${buildTimes(currentDay)[i]} for ${therapistList[t]}</li>`;
      missed++;
    }
    if (state[i][t]==="Call-out") {
      feedback += `<li>Call-out at ${buildTimes(currentDay)[i]} for ${therapistList[t]} (lost revenue)</li>`;
      callouts++;
    }
  }
  feedback += `</ul>`;
  feedback += `<b>Total missed slots:</b> ${missed}. <b>Call-outs:</b> ${callouts}.<br>`;
  feedback += `<b>Estimated Lost Revenue:</b> $${missed*sessionPrice + callouts*(-calloutPrice)}.`;
  feedback += "</div>";
  document.getElementById('feedbackBox').innerHTML = feedback;
}

// Startup
resetProgress();
</script>
</body>
</html>
