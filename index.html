<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Schedule Optimization Training (Upgraded)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Inter:700,600,400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: #f7fafd;
            margin: 0;
        }
        .container {
            max-width: 1400px;
            margin: 32px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 2px 16px rgba(35,49,123,0.06);
            padding: 36px 40px 48px 40px;
        }
        .header {
            font-size: 2.8rem;
            font-weight: 700;
            color: #5962ea;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        .subhead {
            font-size: 1.2rem;
            color: #444;
            margin-bottom: 38px;
        }
        .nav-bar {
            display: flex;
            gap: 48px;
            justify-content: flex-start;
            align-items: center;
            border-bottom: 2px solid #ecedfa;
            margin-bottom: 30px;
            padding-bottom: 7px;
        }
        .nav-tab {
            font-size: 1.25em;
            font-weight: 700;
            background: none;
            border: none;
            color: #5962ea;
            cursor: pointer;
            padding: 14px 0 8px 0;
            position: relative;
            transition: color 0.18s;
            outline: none;
        }
        .nav-tab:not(.active) {
            color: #525252;
            font-weight: 500;
        }
        .nav-tab.active {
            color: #5962ea;
        }
        .nav-tab.active:after {
            content: "";
            position: absolute;
            left: 0; right: 0; bottom: -7px;
            height: 4px;
            background: #5962ea;
            border-radius: 6px;
        }
        .content {
            display: none;
            margin-top: 30px;
        }
        .content.active {
            display: block;
        }
        .scenario-controls {
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 18px;
            flex-wrap: wrap;
        }
        label {
            font-weight: 500;
            margin-right: 6px;
        }
        select, .btn {
            font-size: 1em;
            padding: 7px 20px;
            border-radius: 7px;
            border: 1px solid #bfcbe6;
            background: #f7fafd;
            color: #5962ea;
            margin-right: 6px;
        }
        .btn {
            cursor: pointer;
            font-weight: 600;
        }
        .btn-primary {
            background: #5962ea;
            color: #fff;
            border: none;
        }
        .btn:disabled, .btn[disabled] {
            background: #e0e0e0;
            color: #aaa;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .score-panel {
            display: flex;
            gap: 28px;
            margin: 24px 0 14px 0;
            flex-wrap: wrap;
        }
        .stat-card {
            background: #f1f3fe;
            border-radius: 12px;
            box-shadow: 0 1px 4px #e0e0e0;
            padding: 20px 32px;
            min-width: 120px;
            text-align: center;
            font-size: 1em;
        }
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #5962ea;
            letter-spacing: 1px;
        }
        .stat-label {
            font-size: 1em;
            color: #6d7ba1;
        }
        .hint-box {
            background: #e3e3fa;
            border-radius: 10px;
            padding: 12px 20px;
            margin: 22px 0 14px 0;
            color: #3866e6;
            font-size: 1.08em;
        }
        .solution-box {
            background: #e6ffe8;
            border: 1.5px solid #a8e4c4;
            border-radius: 10px;
            padding: 14px 20px;
            margin-bottom: 18px;
            color: #1e965a;
            font-size: 1.08em;
        }
        .avoid-box {
            background: #ffe6c7;
            border: 1.5px solid #f2b886;
            border-radius: 10px;
            padding: 14px 20px;
            margin-bottom: 18px;
            color: #b07817;
            font-size: 1.08em;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 2px;
            margin-top: 16px;
            background: #e7ecf5;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 1em;
        }
        .time-slot {
            background: #fff;
            border-radius: 6px;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
            border: 1px solid #d2d8ee;
            transition: box-shadow 0.2s;
            cursor: pointer;
        }
        .time-slot.header {
            background: #5962ea;
            color: #fff;
            font-weight: bold;
            border-radius: 6px 6px 0 0;
            min-height: 35px;
        }
        .time-slot.time-header {
            background: #f3f6fc;
            color: #6d7ba1;
            font-weight: bold;
        }
        .booked-80 {
            background: #5962ea;
            color: #fff;
            font-weight: bold;
        }
        .booked-50 {
            background: #5ab2ff;
            color: #fff;
        }
        .gap {
            background: #f7ca4d;
            color: #333;
            font-weight: bold;
        }
        .open {
            background: #e4f8e7;
            color: #22613c;
        }
        .break {
            background: #f3e0fa;
            color: #7c3aed;
            font-weight: 600;
        }
        .lunch {
            background: #e3e9ff;
            color: #2c3e86;
            font-weight: 600;
        }
        .callout {
            background: #ff5757;
            color: #fff;
            font-weight: bold;
        }
        .solution-highlight {
            box-shadow: 0 0 0 3px #5962ea inset, 0 0 12px #5962ea;
            border-radius: 10px;
            font-weight: bold;
            z-index: 2;
        }
        @media (max-width: 900px) {
            .container {
                padding: 18px 4vw;
            }
            .nav-bar {gap:24px;}
        }
        @media (max-width: 700px) {
            .container {padding: 12px 2vw;}
            .nav-bar {gap: 10px;flex-wrap: wrap;}
            .nav-tab {padding: 8px 0 4px 0;}
            .schedule-grid {font-size: 0.9em;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">Schedule Optimization Training (Upgraded)</div>
        <div class="subhead">Master the art of maximizing revenue through smart scheduling</div>
        <div class="nav-bar">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('simulator')">Schedule Simulator</button>
            <button class="nav-tab" onclick="showTab('calculator')">Revenue Calculator</button>
            <button class="nav-tab" onclick="showTab('scenarios')">Practice Scenarios</button>
            <button class="nav-tab" onclick="showTab('quiz')">Knowledge Quiz</button>
            <button class="nav-tab" onclick="showTab('templates')">Script Templates</button>
            <button class="nav-tab" onclick="showTab('progress')">Progress Tracker</button>
        </div>
        <div id="overview" class="content active">
            <h2>Overview</h2>
            <p>Welcome! Use the tabs above to access all modules for schedule optimization and training.</p>
        </div>
        <div id="simulator" class="content">
            <h2>Schedule Simulator</h2>
            <div class="scenario-controls">
                <label for="simDay">Select Day:</label>
                <select id="simDay"></select>
                <label for="simScenario">Scenario:</label>
                <select id="simScenario"></select>
                <button class="btn btn-primary" onclick="loadSimulatorScenario()">Load</button>
                <button class="btn btn-secondary" onclick="clearSchedule()">Clear</button>
            </div>
            <div id="addMassagePanel" style="margin-bottom:24px;">
                <strong>Add Massage:</strong>
                <div style="display:flex; gap:10px; margin-top:8px;">
                    <div class="time-slot booked-80" draggable="true" ondragstart="dragStart(event)" data-type="booked_80">80m</div>
                    <div class="time-slot booked-50" draggable="true" ondragstart="dragStart(event)" data-type="booked_50">50m</div>
                </div>
            </div>
            <div class="score-panel">
                <div class="stat-card">
                    <div class="stat-value" id="movesCount">0</div>
                    <div class="stat-label">Moves</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="gapsFixedCount">0</div>
                    <div class="stat-label">Gaps Fixed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="revenueSaved">$0</div>
                    <div class="stat-label">Revenue Saved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="revenueLost">$0</div>
                    <div class="stat-label">Revenue Lost</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="gradeValue">C</div>
                    <div class="stat-label">Grade</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="utilizationRate">0%</div>
                <div class="stat-label">Utilization Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="gapCount">0</div>
                <div class="stat-label">Gaps</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="optimalPatterns">0</div>
                <div class="stat-label">Optimal Patterns</div>
            </div>
            <div id="hintBox" class="hint-box" style="display:none;"></div>
            <div class="controls" style="margin-top:18px;">
                <button class="btn btn-secondary" onclick="showHint()">Hint</button>
                <button id="showSolutionBtn" class="btn btn-primary" onclick="showSolution()" disabled>Show Solution</button>
                <button class="btn btn-secondary" onclick="nextSimulatorScenario()">Next Scenario</button>
            </div>
            <div class="schedule-grid" id="scheduleGrid"></div>
        </div>
        <div id="calculator" class="content">
            <h2>Revenue Calculator</h2>
            <div class="card">
                [Your revenue calculator goes here]
            </div>
        </div>
        <div id="scenarios" class="content">
            <h2>Practice Scenarios</h2>
            <div class="scenario-controls">
                <label for="scenarioDay">Day:</label>
                <select id="scenarioDay"></select>
                <label for="scenarioNum">Scenario:</label>
                <select id="scenarioNum"></select>
                <button class="btn btn-primary" onclick="loadPracticeScenario()">Load Scenario</button>
            </div>
            <div id="practiceScenarioBox"></div>
        </div>
        <div id="quiz" class="content">
            <h2>Knowledge Quiz</h2>
            <div class="card">
                [Your knowledge quiz goes here]
            </div>
        </div>
        <div id="templates" class="content">
            <h2>Script Templates</h2>
            <div class="card">
                [Your script templates go here]
            </div>
        </div>
        <div id="progress" class="content">
            <h2>Progress Tracker</h2>
            <div class="card">
                [Your progress tracking dashboard goes here]
            </div>
        </div>
    </div>
<script>
// ---- CONFIG ----
const TIMES = [
    "09:00 AM","09:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM",
    "12:00 PM","12:30 PM","01:00 PM","01:30 PM","02:00 PM","02:30 PM",
    "03:00 PM","03:30 PM","04:00 PM","04:30 PM","05:00 PM","05:30 PM",
    "06:00 PM","06:30 PM","07:00 PM","07:30 PM"
];
const THERAPISTS = ["Aaron", "Amy", "Bill", "Gaia", "Hank", "Marti", "Seydonia", "Spencer"];
const BLOCK_TYPES = {
    "booked_80": {label: "80m", colorclass: "booked-80"},
    "booked_50": {label: "50m", colorclass: "booked-50"},
    "gap": {label: "GAP", colorclass: "gap"},
    "open": {label: "OPEN", colorclass: "open"},
    "break": {label: "Break", colorclass: "break"},
    "lunch": {label: "Lunch", colorclass: "lunch"},
    "callout": {label: "Call-out", colorclass: "callout"}
};
const CYCLE_TYPES=["open","booked_80","booked_50","gap","break","lunch","callout"];
const ALL_SCENARIOS = {
    "Sunday": [
        {
            name: "Sunday Example",
            description: "Fill afternoon gaps, stagger breaks/lunches (max 2 at a time).",
            therapists: THERAPISTS,
            schedule: [
                ["booked_80","booked_80","open","open","booked_50","break","booked_80","open","open","lunch","booked_50","open",
                  "booked_80","open","open","break","booked_50","open","open","booked_80","open","open"],
                ["open","booked_80","open","booked_80","open","booked_80","open","booked_50","lunch","open","booked_80","break",
                  "open","booked_80","open","booked_50","open","open","break","booked_80","open","open"],
                ["booked_80","open","break","open","booked_80","open","lunch","booked_80","open","open","booked_80","open",
                  "open","booked_80","open","break","open","booked_80","open","open","lunch","open"],
                ["open","open","booked_80","open","booked_80","break","open","booked_80","open","booked_50","lunch","open",
                  "booked_80","open","open","booked_50","open","open","break","booked_80","open","open"],
                ["booked_80","open","open","booked_80","open","break","booked_80","open","open","lunch","booked_80","open",
                  "open","booked_80","booked_50","open","break","open","open","booked_80","open","open"],
                ["open","booked_80","open","booked_80","open","booked_80","break","open","booked_50","open","lunch","open",
                  "booked_80","open","booked_80","open","open","break","open","booked_80","open","open"],
                ["open","open","booked_80","open","booked_80","break","open","booked_80","open","open","booked_80","lunch",
                  "open","booked_80","open","booked_50","break","open","open","booked_80","open","open"],
                ["booked_80","open","break","open","booked_80","open","open","booked_80","open","open","booked_80","open",
                  "lunch","booked_80","open","break","open","booked_80","open","open","booked_50","open"]
            ],
            correctMoves: [
                "Stagger breaks/lunches so coverage is maintained.",
                "Fill afternoon gaps with bookings.",
                "Max 2 therapists on lunch/break at any time."
            ],
            incorrectMoves: [
                "All lunches/breaks at once.",
                "Leaving gaps during peak hours.",
                "Ignoring afternoon coverage."
            ]
        }
    ],
    "Monday": [
        {
            name: "Monday Medium: Lunch Optimization",
            description: "Stagger lunches to maintain coverage during peak hours.",
            therapists: THERAPISTS,
            schedule: [
                ["booked_80","lunch","booked_80","open","break","booked_80","open","booked_80","open","booked_50","open","break",
                 "booked_80","open","open","booked_80","open","open","lunch","booked_80","open","open"],
                ["open","booked_80","open","break","booked_80","open","booked_50","lunch","open","booked_80","open","open",
                 "break","booked_80","open","booked_80","open","open","booked_80","lunch","open","open"],
                ["booked_80","open","break","open","booked_80","lunch","open","break","open","booked_80","booked_50","open",
                 "booked_80","open","open","open","booked_80","open","break","booked_80","lunch","open"],
                ["open","booked_80","open","break","lunch","booked_80","open","booked_80","break","open","booked_80","open",
                 "booked_50","open","booked_80","open","booked_80","open","open","lunch","booked_80","open"],
                ["booked_80","break","open","booked_80","open","booked_80","lunch","open","booked_80","open","break","booked_80",
                 "open","booked_50","open","open","booked_80","lunch","open","break","booked_80","open"],
                ["open","booked_80","lunch","break","open","booked_80","open","booked_50","open","break","booked_80","open",
                 "open","booked_80","open","booked_80","open","booked_80","break","open","lunch","booked_80"],
                ["break","open","booked_80","open","booked_80","open","lunch","break","booked_80","open","booked_80","open",
                 "open","booked_50","open","booked_80","open","booked_80","open","booked_80","break","lunch"],
                ["booked_80","open","booked_80","lunch","break","open","booked_80","open","booked_50","open","booked_80","break",
                 "open","booked_80","open","open","booked_80","open","break","booked_80","open","lunch"]
            ],
            correctMoves: [
                "Stagger lunches.",
                "Fill afternoon gaps.",
                "Max 2 therapists at lunch."
            ],
            incorrectMoves: [
                "All at lunch simultaneously.",
                "Gaps during peak hours."
            ]
        }
    ]
};
const DAY_LIST = Object.keys(ALL_SCENARIOS);

function capitalize(str) {return str.charAt(0).toUpperCase()+str.slice(1);}
function showTab(tab){
    document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
    document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
    document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
    if(tab==="scenarios")renderScenarioControls();
    if(tab==="simulator")renderSimulatorControls();
}
function renderScenarioControls(){
    let daySel=document.getElementById('scenarioDay');
    let scenSel=document.getElementById('scenarioNum');
    daySel.innerHTML=DAY_LIST.map(d=>`<option value="${d}">${capitalize(d)}</option>`).join('');
    let scens=ALL_SCENARIOS[DAY_LIST[0]];
    scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    daySel.onchange=function(){
        let scens=ALL_SCENARIOS[daySel.value];
        scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    };
}
function loadPracticeScenario(){
    let day=document.getElementById('scenarioDay').value;
    let idx=+document.getElementById('scenarioNum').value;
    let scenario=ALL_SCENARIOS[day][idx];
    let box=document.getElementById('practiceScenarioBox');
    box.innerHTML=`
        <div style="font-size:1.2em;font-weight:600;margin-bottom:6px;">${scenario.name}</div>
        <div style="margin-bottom:16px;">${scenario.description}</div>
        <div class="solution-box"><b>Optimal Solution:</b><br>${scenario.correctMoves.join('<br>')}</div>
        <div class="avoid-box"><b>Avoid:</b><br>${scenario.incorrectMoves.join('<br>')}</div>
    `;
}
function renderSimulatorControls(){
    let daySel=document.getElementById('simDay');
    let scenSel=document.getElementById('simScenario');
    daySel.innerHTML=DAY_LIST.map(d=>`<option value="${d}">${capitalize(d)}</option>`).join('');
    let scens=ALL_SCENARIOS[DAY_LIST[0]];
    scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    daySel.onchange=function(){
        let scens=ALL_SCENARIOS[daySel.value];
        scenSel.innerHTML=scens.map((s,i)=>`<option value="${i}">${s.name}</option>`).join('');
    };
}
let moves=0;
let userAttempts=0;
let solutionShown=false;
function registerUserAttempt() {
    userAttempts++;
    updateShowSolutionButton();
}
function loadSimulatorScenario(){
    let day=document.getElementById('simDay').value;
    let idx=+document.getElementById('simScenario').value;
    let scenario=ALL_SCENARIOS[day][idx];
    renderScheduleGrid(scenario);
    moves=0;
    userAttempts=0;
    solutionShown=false;
    document.getElementById('movesCount').textContent=moves;
    updateShowSolutionButton();
    removeSolutionHighlights();
    hideHint();
}
function clearSchedule(){
    let day=document.getElementById('simDay').value;
    let scenario=ALL_SCENARIOS[day][0];
    let therapists=scenario.therapists;
    let grid=document.getElementById('scheduleGrid');
    grid.innerHTML='';
    grid.style.gridTemplateColumns = `repeat(${therapists.length+1}, 1fr)`;
    grid.innerHTML+=`<div class="time-slot header">Time</div>`;
    therapists.forEach(t=>grid.innerHTML+=`<div class="time-slot header">${t}</div>`);
    for(let t=0;t<TIMES.length;t++){
        grid.innerHTML+=`<div class="time-slot time-header">${TIMES[t]}</div>`;
        for(let i=0;i<therapists.length;i++){
            grid.innerHTML+=`<div class="time-slot open" data-type="open" data-tidx="${i}" data-time="${TIMES[t]}" data-slot-id="${t+'-'+i}" draggable="true" ondragstart="slotDragStart(event)" ondragover="allowDrop(event)" ondrop="dropSlot(event)" onclick="toggleSlot(this)"></div>`;
        }
    }
    moves=0;
    userAttempts=0;
    solutionShown=false;
    updateShowSolutionButton();
    removeSolutionHighlights();
}
function nextSimulatorScenario(){
    let daySel=document.getElementById('simDay');
    let scenSel=document.getElementById('simScenario');
    let day=daySel.value;
    let idx=+scenSel.value;
    let scens=ALL_SCENARIOS[day];
    idx=(idx+1)%scens.length;
    scenSel.value=idx;
    loadSimulatorScenario();
}
function showHint(){
    let box=document.getElementById('hintBox');
    box.style.display="block";
    box.textContent="Tip: Drag, drop, or click to fill gaps, stagger breaks/lunches, and maximize afternoon coverage!";
}
function hideHint(){
    let box=document.getElementById('hintBox');
    box.style.display="none";
}
function updateShowSolutionButton() {
    const btn = document.getElementById('showSolutionBtn');
    btn.disabled = userAttempts < 2;
}
function showSolution() {
    if (userAttempts < 2) return;
    solutionShown = true;
    highlightSolutionCells();
}
function highlightSolutionCells() {
    removeSolutionHighlights();
    let day = document.getElementById('simDay').value;
    let idx = +document.getElementById('simScenario').value;
    let scenario = ALL_SCENARIOS[day][idx];
    scenario.schedule.forEach((therapistSlots, colIdx) => {
        therapistSlots.forEach((slotType, rowIdx) => {
            if (isOptimalCell(slotType, rowIdx, colIdx, scenario)) {
                let slotEl = document.querySelector(`[data-slot-id="${rowIdx+'-'+colIdx}"]`);
                if (slotEl) slotEl.classList.add('solution-highlight');
            }
        });
    });
}
function removeSolutionHighlights() {
    document.querySelectorAll('.solution-highlight').forEach(el => el.classList.remove('solution-highlight'));
}
function isOptimalCell(slotType, rowIdx, colIdx, scenario) {
    // Optimal: lunch/break if no more than 2 at same time, booked_80 after 2pm, and gaps filled
    let lunchBreakTypes = ["lunch","break"];
    let timeHour = parseInt(TIMES[rowIdx].split(":")[0]);
    let pm = TIMES[rowIdx].includes("PM");
    let count = 0;
    scenario.schedule.forEach(tb => {
        if (lunchBreakTypes.includes(tb[rowIdx])) count++;
    });
    // Staggered lunch/breaks
    if(lunchBreakTypes.includes(slotType) && count<=2) return true;
    // Booked_80 after 2pm
    if(slotType==="booked_80" && ((pm&&timeHour>=2)||(!pm&&timeHour>=14))) return true;
    // No gaps in peak hours
    if(slotType==="gap" && rowIdx>=8 && rowIdx<=16) return false;
    return false;
}
let draggedType=null;
let draggedSlot=null;
function dragStart(e){
    draggedType=e.target.dataset.type;
    draggedSlot=null;
    e.dataTransfer.effectAllowed="move";
}
function allowDrop(e){e.preventDefault();}
function dropSlot(e){
    e.preventDefault();
    let slot=e.target;
    if(draggedType){
        slot.dataset.type=draggedType;
        slot.className="time-slot "+(BLOCK_TYPES[draggedType]?.colorclass||"");
        slot.textContent=BLOCK_TYPES[draggedType]?.label||"";
        moves++;
        registerUserAttempt();
        document.getElementById('movesCount').textContent=moves;
        hideHint();
        draggedType=null;
        draggedSlot=null;
        updateScheduleStats();
        return;
    }
    if(draggedSlot){
        let fromSlot=document.querySelector(`[data-slot-id='${draggedSlot}']`);
        let tempType=slot.dataset.type;
        let tempLabel=slot.textContent;
        let tempClass=slot.className;
        slot.dataset.type=fromSlot.dataset.type;
        slot.className=fromSlot.className;
        slot.textContent=fromSlot.textContent;
        fromSlot.dataset.type=tempType;
        fromSlot.className=tempClass;
        fromSlot.textContent=tempLabel;
        moves++;
        registerUserAttempt();
        document.getElementById('movesCount').textContent=moves;
        hideHint();
        draggedType=null;
        draggedSlot=null;
        updateScheduleStats();
        return;
    }
}
function slotDragStart(e){
    draggedType=e.target.dataset.type;
    draggedSlot=e.target.dataset.slotId;
    e.dataTransfer.effectAllowed="move";
}
function toggleSlot(slot){
    let cur=slot.dataset.type||"open";
    let idx=CYCLE_TYPES.indexOf(cur);
    let nextType=CYCLE_TYPES[(idx+1)%CYCLE_TYPES.length];
    slot.dataset.type=nextType;
    slot.className="time-slot "+(BLOCK_TYPES[nextType]?.colorclass||"");
    slot.textContent=BLOCK_TYPES[nextType]?.label||"";
    moves++;
    registerUserAttempt();
    document.getElementById('movesCount').textContent=moves;
    hideHint();
    updateScheduleStats();
}
function renderScheduleGrid(scenario){
    let grid=document.getElementById('scheduleGrid');
    let therapists=scenario.therapists;
    grid.innerHTML='';
    grid.style.gridTemplateColumns = `repeat(${therapists.length+1}, 1fr)`;
    grid.innerHTML+=`<div class="time-slot header">Time</div>`;
    therapists.forEach(t=>grid.innerHTML+=`<div class="time-slot header">${t}</div>`);
    for(let t=0;t<TIMES.length;t++){
        grid.innerHTML+=`<div class="time-slot time-header">${TIMES[t]}</div>`;
        for(let i=0;i<therapists.length;i++){
            let type=(scenario.schedule[i]&&scenario.schedule[i][t])||'open';
            let block=BLOCK_TYPES[type]||{label:"",colorclass:""};
            grid.innerHTML+=`<div class="time-slot ${block.colorclass}" data-type="${type}" data-tidx="${i}" data-time="${TIMES[t]}" data-slot-id="${t+'-'+i}" draggable="true" ondragstart="slotDragStart(event)" ondragover="allowDrop(event)" ondrop="dropSlot(event)" onclick="toggleSlot(this)">${block.label||""}</div>`;
        }
    }
    updateScheduleStats();
    removeSolutionHighlights();
}
function updateScheduleStats(){
    let slots=document.querySelectorAll('.schedule-grid .time-slot:not(.header):not(.time-header)');
    let booked=0,gaps=0,open=0,optimal=0;
    slots.forEach(s=>{
        let type=s.dataset.type;
        if(type==="open")open++;
        if(type==="gap")gaps++;
        if(type&&type.startsWith("booked"))booked++;
        if(type==="booked_80"||type==="booked_50")optimal++;
    });
    let total=slots.length;
    let utilization=Math.round(100*booked/total);
    document.getElementById('utilizationRate').textContent=utilization+"%";
    document.getElementById('gapCount').textContent=gaps;
    document.getElementById('optimalPatterns').textContent=optimal;
    document.getElementById('gapsFixedCount').textContent=gaps===0?"All":(total-gaps);
    document.getElementById('revenueSaved').textContent="$"+(booked*120);
    document.getElementById('revenueLost').textContent="$"+(gaps*120);
    document.getElementById('gradeValue').textContent=utilization>80&&gaps===0?"A":utilization>70?"B":"C";
}
window.onload=function(){
    showTab('overview');
    renderScenarioControls();
    renderSimulatorControls();
    updateShowSolutionButton();
};
</script>
</body>
</html>
