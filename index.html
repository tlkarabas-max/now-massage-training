<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Schedule Optimization Training (Full-Day Interactive)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fd; margin: 0; }
    .container { max-width: 1200px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px #eee; padding: 32px; }
    h1 { color: #6170f7; font-size: 2.8rem; margin-bottom: 0.5rem; }
    .subtitle { color: #333; font-size: 1.2rem; margin-bottom: 2rem; }
    .tabs { display: flex; border-bottom: 2px solid #e3e6ef; margin-bottom: 2rem; }
    .tab { padding: 16px 32px; cursor: pointer; font-size: 1.1rem; color: #444; border: none; background: none; outline: none; }
    .tab.active { color: #6170f7; font-weight: bold; border-bottom: 3px solid #6170f7; }
    .tab:not(.active):hover { color: #6170f7; background: #eaf0ff; }
    .section { display: none; }
    .section.active { display: block; }
    .simulator-metrics { display: flex; gap: 32px; margin: 1.5rem 0 1rem 0; }
    .sim-metric { background: #f2f3f8; border-radius: 8px; padding: 16px 24px; text-align: center; min-width: 120px; }
    .sim-metric-value { font-size: 2rem; color: #6170f7; font-weight: bold; }
    .sim-metric-label { font-size: 1.1rem; color: #555; }
    .simulator-actions { margin-bottom: 1rem; }
    .simulator-actions button { margin-right: 8px; padding: 8px 18px; border-radius: 6px; border: none; font-size: 1rem; color: #6170f7; background: #f2f3f8; font-weight: bold; }
    .simulator-actions button.active, .simulator-actions button:active { background: #dbe5ff; }
    .simulator-actions button:disabled { color: #bbb; background: #f9f9f9; }
    .schedule-table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    .schedule-table th, .schedule-table td { border: 1px solid #e3e6ef; padding: 10px; text-align: center; }
    .schedule-table th { background: #6170f7; color: #fff; }
    .schedule-block-open { background: #d5f5e3; cursor: pointer; }
    .schedule-block-gap { background: #fcf3cf; color: #b7950b; font-weight: bold; cursor: pointer; }
    .schedule-block-callout { background: #f5b7b1; color: #c0392b; font-weight: bold; cursor: pointer; }
    .schedule-block-lunch { background: #d5d8dc; color: #636e72; font-weight: bold; cursor: not-allowed;}
    .schedule-block-break { background: #c39bd3; color: #5b2c6f; font-weight: bold; cursor: not-allowed;}
    .schedule-block-personal { background: #aed6f1; color: #21618c; font-weight: bold; cursor: not-allowed;}
    .schedule-block-session { background: #d6eaf8; color: #1f618d; cursor: pointer;}
    .schedule-block { border-radius: 6px; padding: 8px 0; }
    .scenario-desc { background: #f2f3f8; border-radius: 8px; padding: 16px 24px; margin-top: 1rem; margin-bottom: 1rem; }
    .hint-text { color: #6170f7; background: #eaf0ff; border-radius: 6px; padding: 10px; margin-top: 1rem; margin-bottom: 1rem;}
    .solution-table { margin-top: 2rem;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Schedule Optimization Training (Upgraded)</h1>
    <div class="subtitle">Master the art of maximizing revenue through smart scheduling</div>
    <div class="tabs">
      <button class="tab active" onclick="showSection('simulator')">Schedule Simulator</button>
      <button class="tab" onclick="showSection('overview')">Overview</button>
    </div>

    <!-- Schedule Simulator Section -->
    <div id="simulator" class="section active">
      <h2>Schedule Simulator</h2>
      <form id="simulator-form">
        <label for="sim-day-sim">Select Day:</label>
        <select id="sim-day-sim" name="sim-day-sim" onchange="loadScenario()">
          <option>Monday</option>
          <option>Tuesday</option>
          <option>Wednesday</option>
        </select>
      </form>
      <div class="scenario-desc" id="scenario-desc"></div>
      <div class="simulator-metrics">
        <div class="sim-metric"><div class="sim-metric-value" id="moves-count">0</div><div class="sim-metric-label">Moves</div></div>
        <div class="sim-metric"><div class="sim-metric-value" id="gaps-count">0</div><div class="sim-metric-label">Gaps Fixed</div></div>
        <div class="sim-metric"><div class="sim-metric-value" id="rev-saved">$0</div><div class="sim-metric-label">Revenue Saved</div></div>
        <div class="sim-metric"><div class="sim-metric-value" id="rev-lost">$0</div><div class="sim-metric-label">Revenue Lost</div></div>
        <div class="sim-metric"><div class="sim-metric-value" id="grade">C</div><div class="sim-metric-label">Grade</div></div>
      </div>
      <div class="simulator-actions">
        <button type="button" onclick="showHint()">Hint</button>
        <button type="button" onclick="showSolution()">Show Solution</button>
        <button type="button" onclick="nextScenario()">Next Scenario</button>
      </div>
      <div id="hint-area"></div>
      <div id="schedule-table-wrapper"></div>
      <div id="solution-table-wrapper"></div>
    </div>

    <!-- Overview Section -->
    <div id="overview" class="section">
      <h2>Welcome to Schedule Optimization Training!</h2>
      <p>
        This platform helps you optimize full-day therapist schedules using realistic scenarios and hands-on interactivity.<br>
        <ul>
          <li>Try fixing gaps, call-outs, and coverage using interactive schedule blocks</li>
          <li>Use hints and solutions to learn best practices</li>
        </ul>
      </p>
    </div>
  </div>
  <script>
    function showSection(id) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      let index = {simulator:0, overview:1}[id];
      document.querySelectorAll('.tab')[index].classList.add('active');
    }

    // Therapist labels, time slots, scenario logic
    const therapistLabels = ["MT1", "MT2", "MT3", "MT4"];
    const timeSlots = [
      "08:00 AM","08:15 AM","08:30 AM","08:45 AM",
      "09:00 AM","09:15 AM","09:30 AM","09:45 AM",
      "10:00 AM","10:15 AM","10:30 AM","10:45 AM",
      "11:00 AM","11:15 AM","11:30 AM","11:45 AM",
      "12:00 PM","12:15 PM","12:30 PM","12:45 PM",
      "01:00 PM","01:15 PM","01:30 PM","01:45 PM",
      "02:00 PM","02:15 PM","02:30 PM","02:45 PM",
      "03:00 PM","03:15 PM","03:30 PM","03:45 PM",
      "04:00 PM","04:15 PM","04:30 PM","04:45 PM",
      "05:00 PM","05:15 PM","05:30 PM","05:45 PM",
      "06:00 PM","06:15 PM","06:30 PM","06:45 PM",
      "07:00 PM"
    ];

    // Scenarios and solutions for each day
    const scenarios = {
      "Monday": {
        desc: `<strong>Scenario:</strong> MT2 called out sick for the entire day.<br>
          <strong>Goal:</strong> Redistribute MT2's appointments to MT1, MT3, and MT4 to minimize gaps and maximize coverage.<br>
          <strong>Avoid:</strong> Leaving gaps, unused open slots.`,
        initial: [
          // Each row: [MT1, MT2, MT3, MT4]
          ["OPEN","Call-out","80m","OPEN"],["OPEN","Call-out","OPEN","80m"],["80m","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],
          ["Lunch","Call-out","Lunch","OPEN"],["OPEN","Call-out","Lunch","Lunch"],["80m","Call-out","80m","80m"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["80m","Call-out","80m","80m"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["Lunch","Call-out","Lunch","OPEN"],["OPEN","Call-out","Lunch","Lunch"],["80m","Call-out","80m","80m"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["80m","Call-out","80m","80m"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["80m","Call-out","80m","80m"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],
          ["OPEN","Call-out","OPEN","OPEN"],["OPEN","Call-out","OPEN","OPEN"],["80m","Call-out","80m","80m"],["OPEN","Call-out","OPEN","OPEN"],
        ],
        solution: [
          ["OPEN","OPEN","80m","OPEN"],["OPEN","80m","OPEN","80m"],["80m","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["Lunch","OPEN","Lunch","OPEN"],["OPEN","OPEN","Lunch","Lunch"],["80m","OPEN","80m","80m"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["80m","OPEN","80m","80m"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["Lunch","OPEN","Lunch","OPEN"],["OPEN","OPEN","Lunch","Lunch"],["80m","OPEN","80m","80m"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["80m","OPEN","80m","80m"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["80m","OPEN","80m","80m"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["80m","OPEN","80m","80m"],["OPEN","OPEN","OPEN","OPEN"],
        ]
      },
      "Tuesday": {
        desc: `<strong>Scenario:</strong> Multiple gaps in the afternoon.<br>
          <strong>Goal:</strong> Reassign appointments and fill gaps without leaving therapists idle.<br>
          <strong>Avoid:</strong> Idle therapists, unused open slots.`,
        initial: [
          ["80m","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],["OPEN","OPEN","OPEN","80m"],
          ["Lunch","Lunch","Lunch","Lunch"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","GAP","OPEN","OPEN"],["OPEN","OPEN","GAP","OPEN"],
          ["OPEN","OPEN","OPEN","GAP"],["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],
          ["OPEN","OPEN","OPEN","80m"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","GAP","OPEN","OPEN"],["OPEN","OPEN","GAP","OPEN"],
          ["OPEN","OPEN","OPEN","GAP"],["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],
          ["OPEN","OPEN","OPEN","80m"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
        ],
        solution: [
          ["80m","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],["OPEN","OPEN","OPEN","80m"],
          ["Lunch","Lunch","Lunch","Lunch"],["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],
          ["OPEN","OPEN","OPEN","80m"],["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],
          ["OPEN","OPEN","OPEN","80m"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],
          ["OPEN","OPEN","OPEN","80m"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
        ]
      },
      "Wednesday": {
        desc: `<strong>Scenario:</strong> Lunch and break blocks are staggered.<br>
          <strong>Goal:</strong> Maximize coverage during peak hours while ensuring legal breaks.<br>
          <strong>Avoid:</strong> Coverage gaps during busy periods.`,
        initial: [
          ["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],["OPEN","OPEN","OPEN","80m"],
          ["Lunch","OPEN","OPEN","OPEN"],["OPEN","Lunch","OPEN","OPEN"],["OPEN","OPEN","Lunch","OPEN"],["OPEN","OPEN","OPEN","Lunch"],
          ["Break","OPEN","OPEN","OPEN"],["OPEN","Break","OPEN","OPEN"],["OPEN","OPEN","Break","OPEN"],["OPEN","OPEN","OPEN","Break"],
          ["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],["OPEN","OPEN","OPEN","80m"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
        ],
        solution: [
          ["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],["OPEN","OPEN","OPEN","80m"],
          ["Lunch","OPEN","OPEN","OPEN"],["OPEN","Lunch","OPEN","OPEN"],["OPEN","OPEN","Lunch","OPEN"],["OPEN","OPEN","OPEN","Lunch"],
          ["Break","OPEN","OPEN","OPEN"],["OPEN","Break","OPEN","OPEN"],["OPEN","OPEN","Break","OPEN"],["OPEN","OPEN","OPEN","Break"],
          ["80m","OPEN","OPEN","OPEN"],["OPEN","80m","OPEN","OPEN"],["OPEN","OPEN","80m","OPEN"],["OPEN","OPEN","OPEN","80m"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
          ["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],["OPEN","OPEN","OPEN","OPEN"],
        ]
      }
    };

    let currentDay = "Monday";
    let currentSchedule = [];
    let moves = 0;

    function loadScenario() {
      document.getElementById('hint-area').innerHTML = "";
      document.getElementById('solution-table-wrapper').innerHTML = "";
      moves = 0;
      document.getElementById('moves-count').textContent = moves;
      document.getElementById('gaps-count').textContent = "0";
      document.getElementById('rev-saved').textContent = "$0";
      document.getElementById('rev-lost').textContent = "$0";
      document.getElementById('grade').textContent = "C";
      currentDay = document.getElementById('sim-day-sim').value;
      document.getElementById('scenario-desc').innerHTML = scenarios[currentDay].desc;
      // Deep copy of initial scenario (so interactive changes are isolated)
      currentSchedule = scenarios[currentDay].initial.map(row => row.slice());
      renderScheduleTable();
    }

    function renderScheduleTable() {
      let table = `<table class="schedule-table"><tr><th>Time</th>`;
      therapistLabels.forEach(label => table += `<th>${label}</th>`);
      table += `</tr>`;
      for (let i = 0; i < timeSlots.length; i++) {
        table += `<tr><td>${timeSlots[i]}</td>`;
        for (let j = 0; j < therapistLabels.length; j++) {
          let cell = currentSchedule[i] ? currentSchedule[i][j] : "OPEN";
          let blockClass = "schedule-block";
          if (cell === "OPEN") blockClass += " schedule-block-open";
          else if (cell === "GAP") blockClass += " schedule-block-gap";
          else if (cell === "Call-out") blockClass += " schedule-block-callout";
          else if (cell === "Lunch") blockClass += " schedule-block-lunch";
          else if (cell === "Break") blockClass += " schedule-block-break";
          else if (cell === "Personal Time") blockClass += " schedule-block-personal";
          else if (cell.endsWith("m")) blockClass += " schedule-block-session";
          else blockClass += " schedule-block-open";
          // Only allow interactivity for OPEN, GAP, Call-out, session
          let interactive = ["OPEN","GAP","Call-out"].includes(cell) || cell.endsWith("m");
          table += `<td class="${blockClass}" data-row="${i}" data-col="${j}" ${interactive ? 'onclick="blockClicked(this)"' : ''}>${cell}</td>`;
        }
        table += `</tr>`;
      }
      table += `</table>`;
      document.getElementById('schedule-table-wrapper').innerHTML = table;
    }

    function blockClicked(td) {
      let row = parseInt(td.getAttribute('data-row'));
      let col = parseInt(td.getAttribute('data-col'));
      let cell = currentSchedule[row][col];
      // Cycle cell state: OPEN → 80m → GAP → Call-out → OPEN
      let states = ["OPEN","80m","GAP","Call-out"];
      let idx = states.indexOf(cell);
      let nextIdx = (idx + 1) % states.length;
      currentSchedule[row][col] = states[nextIdx];
      moves++;
      document.getElementById('moves-count').textContent = moves;
      renderScheduleTable();
      updateMetrics();
    }

    function updateMetrics() {
      // Simple metrics: gaps fixed = count of GAP replaced, revenue saved = count of session blocks, grade = A/B/C
      let gapsFixed = 0, sessions = 0, callouts = 0;
      for (let i = 0; i < currentSchedule.length; i++) {
        for (let j = 0; j < therapistLabels.length; j++) {
          let cell = currentSchedule[i][j];
          if (cell === "GAP") gapsFixed++;
          if (cell.endsWith("m")) sessions++;
          if (cell === "Call-out") callouts++;
        }
      }
      document.getElementById('gaps-count').textContent = gapsFixed;
      document.getElementById('rev-saved').textContent = "$" + (sessions * 80);
      document.getElementById('rev-lost').textContent = "$" + (callouts * 80);
      let grade = "C";
      if (gapsFixed === 0 && callouts === 0) grade = "A";
      else if (gapsFixed < 3 && callouts < 3) grade = "B";
      document.getElementById('grade').textContent = grade;
    }

    function showHint() {
      document.getElementById('hint-area').innerHTML = `<div class="hint-text">
      <strong>Hint:</strong> Move sessions from MT2's Call-out blocks to OPEN slots on other therapists. Try to fill all gaps and avoid leaving any therapist idle.
      </div>`;
    }

    function showSolution() {
      let solution = scenarios[currentDay].solution;
      let table = `<table class="schedule-table solution-table"><tr><th>Time</th>`;
      therapistLabels.forEach(label => table += `<th>${label}</th>`);
      table += `</tr>`;
      for (let i = 0; i < timeSlots.length; i++) {
        table += `<tr><td>${timeSlots[i]}</td>`;
        for (let j = 0; j < therapistLabels.length; j++) {
          let cell = solution[i] ? solution[i][j] : "OPEN";
          let blockClass = "schedule-block";
          if (cell === "OPEN") blockClass += " schedule-block-open";
          else if (cell === "GAP") blockClass += " schedule-block-gap";
          else if (cell === "Call-out") blockClass += " schedule-block-callout";
          else if (cell === "Lunch") blockClass += " schedule-block-lunch";
          else if (cell === "Break") blockClass += " schedule-block-break";
          else if (cell === "Personal Time") blockClass += " schedule-block-personal";
          else if (cell.endsWith("m")) blockClass += " schedule-block-session";
          else blockClass += " schedule-block-open";
          table += `<td class="${blockClass}">${cell}</td>`;
        }
        table += `</tr>`;
      }
      table += `</table>`;
      document.getElementById('solution-table-wrapper').innerHTML = table;
    }

    function nextScenario() {
      // For now, cycles through days
      let days = Object.keys(scenarios);
      let idx = days.indexOf(currentDay);
      let nextIdx = (idx + 1) % days.length;
      document.getElementById('sim-day-sim').value = days[nextIdx];
      loadScenario();
    }

    document.addEventListener('DOMContentLoaded', function() {
      loadScenario();
    });
  </script>
</body>
</html>
